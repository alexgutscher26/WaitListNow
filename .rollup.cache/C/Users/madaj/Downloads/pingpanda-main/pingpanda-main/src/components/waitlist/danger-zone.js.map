{"version":3,"file":"danger-zone.js","sourceRoot":"","sources":["danger-zone.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Button } from '@/components/ui/button';\r\nimport { toast } from '@/components/ui/use-toast';\r\nimport { Loader2, Trash2, Download } from 'lucide-react';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog';\r\n\r\ninterface DangerZoneProps {\r\n  waitlistId: string;\r\n  waitlistName: string;\r\n}\r\n\r\nexport function DangerZone({ waitlistId, waitlistName }: DangerZoneProps) {\r\n  const router = useRouter();\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [isExporting, setIsExporting] = useState(false);\r\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      const response = await fetch(`/api/waitlists/${waitlistId}`, {\r\n        method: 'DELETE',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to delete waitlist');\r\n      }\r\n\r\n      toast({\r\n        title: 'Success',\r\n        description: 'Waitlist deleted successfully',\r\n      });\r\n\r\n      // Redirect to dashboard after deletion\r\n      router.push('/dashboard');\r\n    } catch (error) {\r\n      console.error('Error deleting waitlist:', error);\r\n      toast({\r\n        title: 'Error',\r\n        description: 'Failed to delete waitlist. Please try again.',\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setShowDeleteDialog(false);\r\n    }\r\n  };\r\n\r\n  const handleExport = async () => {\r\n    try {\r\n      setIsExporting(true);\r\n      const response = await fetch(`/api/waitlists/${waitlistId}/export`, {\r\n        method: 'GET',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to export subscribers');\r\n      }\r\n\r\n      // Get the filename from the Content-Disposition header\r\n      const contentDisposition = response.headers.get('Content-Disposition');\r\n      const filename = contentDisposition\r\n        ? contentDisposition.split('filename=')[1].replace(/\"/g, '')\r\n        : `subscribers-${waitlistId}.csv`;\r\n\r\n      // Create a blob from the response and trigger download\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = filename;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n      a.remove();\r\n\r\n      toast({\r\n        title: 'Success',\r\n        description: 'Subscribers exported successfully',\r\n      });\r\n    } catch (error) {\r\n      console.error('Error exporting subscribers:', error);\r\n      toast({\r\n        title: 'Error',\r\n        description: 'Failed to export subscribers. Please try again.',\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setIsExporting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"rounded-md border border-red-200 bg-white p-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h4 className=\"font-medium text-red-800\">Delete Waitlist</h4>\r\n            <p className=\"text-sm text-red-600\">\r\n              Once deleted, all subscribers and data will be permanently removed.\r\n            </p>\r\n          </div>\r\n          <Button\r\n            variant=\"destructive\"\r\n            onClick={() => setShowDeleteDialog(true)}\r\n            disabled={isDeleting}\r\n          >\r\n            {isDeleting ? (\r\n              <>\r\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                Deleting...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Trash2 className=\"mr-2 h-4 w-4\" />\r\n                Delete Waitlist\r\n              </>\r\n            )}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"rounded-md border border-amber-200 bg-white p-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h4 className=\"font-medium text-amber-800\">Export Subscribers</h4>\r\n            <p className=\"text-sm text-amber-600\">Download all subscriber data as a CSV file.</p>\r\n          </div>\r\n          <Button\r\n            variant=\"outline\"\r\n            className=\"border-amber-300 text-amber-700 hover:bg-amber-50\"\r\n            onClick={handleExport}\r\n            disabled={isExporting}\r\n          >\r\n            {isExporting ? (\r\n              <>\r\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                Exporting...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Download className=\"mr-2 h-4 w-4\" />\r\n                Export CSV\r\n              </>\r\n            )}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <AlertDialog\r\n        open={showDeleteDialog}\r\n        onOpenChange={setShowDeleteDialog}\r\n      >\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              This action cannot be undone. This will permanently delete the \"{waitlistName}\"\r\n              waitlist and remove all associated subscriber data from our servers.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel disabled={isDeleting}>Cancel</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleDelete}\r\n              className=\"bg-red-600 hover:bg-red-700 focus:ring-red-500\"\r\n              disabled={isDeleting}\r\n            >\r\n              {isDeleting ? (\r\n                <>\r\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                  Deleting...\r\n                </>\r\n              ) : (\r\n                'Delete permanently'\r\n              )}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </div>\r\n  );\r\n}\r\n"]}